---
title: 他社運営案件でGmailの送信者ガイドラインに対応した話
tags:
  - mail
  - Gmail
  - プロトコル
  - メール送信
private: false
updated_at: '2025-04-15T10:23:10+09:00'
id: 4222096736171179f36f
organization_url_name: null
slide: false
ignorePublish: false
---
# はじめに
こんにちは。
今回記事にまとめるのは過去に私がGmailの送信者ガイドラインに対応したときのお話です。
私は現在、他社で開発されたアプリの運営プロジェクトに所属しており、保守・運営・継続的な開発業務を行っています。

その最中、お問い合わせの返信でGmail宛てのメールが届かないことが発覚しました。
自社で開発・運営を行っているものについては対処法もごろごろと転がっていますが、他社商品の運営に関しての記事はありませんでしたので、解決までの道筋を記録しておきます。

# 1. 状況の把握
### 送信可能なドメインの調査
まず確認したのは送信ができるドメインとできないドメインの調査です。
実際にいくつかのメールアドレスに対してメールを送り、受信できていないものを探します。
結果として、今回はGmailだけ受信できていないことがわかりましたので、Gmailについての情報を集めていきます。

### Gmailの調査
上記でGmailのみで送信したメールが受信できていないことが判明しましたので、次はいつから送信できていないかを探りました。
これは実際に返信があったかどうかをもとに判断しています。
すると2024年9月あたりからこの現象が起きたと判明しました。

そこからGmailと2024年にあたりをつけて、仕様の変更点を探していくことになります。
すると、[メール送信者のガイドライン](https://support.google.com/a/answer/81126?hl=ja)というページに行きつきました。

# 2. 問題の特定
上記の調査から[メール送信者のガイドライン](https://support.google.com/a/answer/81126?hl=ja)に沿った対応ができていないのではと予想し、これらの対応ができているかをひとつずつ確認していきました。

すると、SPF・DKIM・DMARCへの対応が不十分であるのではと行きつきました。

:::note warn
SPF・DKIM・DMARCの確認方法を調べているとGmailを使用した確認方法ばかりが出てきます。
~~（そのGmaiが届かなくて困ってるんだ！）~~
:::

:::note
代替手段としてThunderBirdでも確認ができます。
~~（この対応後にGmailで確認したらそっちの方が見やすい...そりゃみんなGmailで確認するよね...）~~
:::

### SPF・DKIM・DMARCの設定を確認する
1. ThunderBirdでメールを開き、「その他」から「ソースを表示」を選択すると確認ができます！
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3562533/b0b4412f-e489-4e91-ab24-30fbcbc374ce.png)

2. 「Authentication-Results:」の箇所にSPF・DKIM・DMARCが書いてあるのでそちらを確認しましょう

### 他社商品の運営ならではの問題
しかし、SPF・DKIMも設定はされていました。
つぎにこれらの値が正しいかどうかの確認を行います。

1. 先ほどのソースの確認から「Received: from」の部分を確認し、送信元のIPアドレスを確認します
2. ターミナルを開いて`nslookup 調べたIPアドレス`で送信ホストの情報を得ます
2. ここで出てきたドメインを使って`nslookup 調べたドメイン名`を何度か行い、送信元の特定行います

この調査の結果、先方から送信されるメールに関するSPFは設定がされていましたが、当社から送信するメールにはSPFが正しく設定されていませんでした。

先方に連絡し、当社のSPFの設定を追加することで無事にメールが届きました。

この結果、私たちのプロジェクトのメールドメインにはSPF・DKIM・DMARCの設定が不十分であることがわかりました。

::: note
`nslookup -type=text メールドメイン名`を行い、設定が追加されているか確認しておきましょう。
:::

# おわりに
今回は他社の運営ならではの問題かもしれませんが、SPFの設定に当社から送信するメールの設定が抜けていたことが原因でした。

当プロジェクトは先方から運営に関するすべてを委任していただいていることもあり、メールの送信についても会社で使用しているメールサーバを通じて送る仕組みになっていたことも一つの要因でした。

そんなに多くある例ではありませんが、同じく状況に陥って困っている人の救いになればと思います。
